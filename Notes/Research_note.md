# 研究ノート

### 2019/04/11
　最近はすっかり研究ノートの更新をとめてしまっていたが，ここらへんで再開しようと思う。再開を機に，wordでの環境をやめて，mdで記録して，Gitにmergeできるようにしたいと思った。  $\LaTeX$ 記法が使えて便利
##### Advancing Human Assessment [Chapter 3]
###### Psychometric Contributions: Focus on Test Scores
　テスト得点にフォーカスした章だった。基本的な古典的テスト理論の式から，信頼性係数，真値から観測値への回帰得点など盛りだくさんだった。基本的に古典的テスト理論(Classical Test Theory)の範疇の話だったが，途中で欠測値の話もあって面白かった。特にKristofの提案した，2部以上に分割した場合の信頼性係数などは日本のテキストでは今まで見たことがなかったもので興味深かった。  
　基本的なテスト$X$からテスト$Y$への回帰得点の式は，
$$
\begin{eqnarray}
Y = \mu(Y|X) + \epsilon = \mu_Y + \rho_{X, Y}\frac{\sigma_Y}{\sigma_Y}(X-\mu_X)+\epsilon
\end{eqnarray}
$$

である。$\rho_{X, Y}\frac{\sigma_Y}{\sigma_Y}$ が回帰係数の傾きにあたる。観測値から真値を推定する式は[池田(1973)](https://1drv.ms/b/s!AmmvfkpgY6-miNkvVhdUtaueG9-50Q)を参考にして，
$$
\hat T = \rho(X)X+(1-\rho(X))\mu(X)
$$
で表されることが分かる。なお $\rho(X)$ はテスト得点$X$の信頼性係数である。この式が意味するところはテスト$X$の信頼性係数が高ければ観測値の得点がそのまま真値に一致し，そうでなければテスト$X$の得点が重みづけられるという内容になっている。[Brennan](https://1drv.ms/b/s!AmmvfkpgY6-miNku6OA25627QDu-fw)のテキストにも同様の内容がある。

### 2019/04/12
##### Advancing Human Assessment [Chapter 4]  

##### GIRTモデルについての検討  

　野澤さんに話したところ，結構興味を示してくれた。パラメタ $\phi$ の解釈をどうするかが今後の大きな課題になると思う。Torgersonの一般正規累積モデルをよく理解しなくてはいけないだろう。[孫・芝(1989)](https://www.jstage.jst.go.jp/article/jjep1953/38/4/38_360/_pdf)では， $\phi$ の解釈についても触れており，個人能力パラメタが $\theta$　と $\phi$ であるような受検者がある特定のパラメタを持つ項目群に正答する確率を，項目特性曲線が返す確率であると解釈すれば， $\phi$ が個人の能力値の変動を表していると解釈しても問題ないとしている。つまり，「まったく同じ項目」ではなく「問題自体は違うが項目パラメタが同じ項目群」を想定するのである。解釈自体は不可能ではないが，テストの特性にもよるだろう。

### 2019/04/15
##### GIRTモデルについての検討 その2
　$\phi$ の推定値の改善。モデルの仮定の上で， $\theta$ と $\phi$ は独立であるとしているから，仮に相関を仮定したモデルを適用しても，そこまで改善は見込めないはず。  
　標本の大きさの問題ではないかと考え，ひとまず項目数を200で推定してみたが，若干相関係数が高くなった（0.5 -> 0.7程度）。次は項目数をさらに倍の400で推定を実行してみたところ，相関係数が0.85程度まで上昇した。詰まるところ，安定した $\phi$ パラメタの推定には通常のIRTモデルよりも，より多くの項目が必要になる。
##### GRMの期待得点から $b_{jk}$ を推定したい
　一筋縄ではいかない。期待得点自体が，他のカテゴリの反応確率の影響を受けているため。  
　推定期待得点関数 $F(\theta|\delta)$ を任意の多項式などで推定し，そこからカテゴリ $k$ までの期待得点関数 $E_j(\theta)$ を引くことで，観測されたかった $k+1$ の境界カテゴリ曲線(Boundary Category Curve, BCC)をえることができる。さらにそのBCCの $b_{k+1}^\ast$ を求め（確率値50
％の位置の $theta$ がそれに等しい）， $b_k+2$（もしくは0）から引くような形で $P_{j,k+1}$ を求める事ができる。

### 2019/04/16
##### 不等式制約付き最適化について調べる
　単調増加の制約をおいた状態でカーブフィッティングをおこなうためには，不等式制約付き最適化の問題を解く必要があるはずである。調べたけど，基本的にはラグランジュで解くことができる様だ（[[1]](https://www.iwanttobeacat.com/entry/2018/01/30/210446)，[[2]](http://www2.kaiyodai.ac.jp/~yoshi-s/Lectures/Optimization/2013/lecture_4.pdf)）。  
　不等式制約条件付きの最小化の場合，まずラグラジアンをパラメタについて偏微分して，連立方程式を解き，そこから得られた $\lambda$ にの関数を最大化すれば良い。仮に解析的に解けないのであれば，反復計算を必要とするだろう。

##### カーブフィッティング in R
　lm, nls, solnp関数は試した。それからガウス過程回帰も試してみた。プロットのデータを見たところ，17カテゴリあるデータでは，他の項目の影響を受けるせいか，同じ得点でもかなり $\theta$ にばらつきがある。これではフィッティングがあまりうまくいかなそう。ぱっと思いついた解決策としては，項目得点ではなく，テスト全体の得点をrescalingして観測得点として用いるのはどうだろうか。    
　そもそも観測得点の方は順序カテゴリカルなデータなのだから，回帰の方法にも工夫が必要なのではないか？順序ロジットとか？  
　スプライン関数についてすこし調べてみたい。入力空間を分割し，閣僚域内で多項式を当てはめてカーブフィッティングできる。これは有力そう。

#### 2019/04/17
##### SVM
　二値線形（非線形）分類の手法であるSVMを利用すれば，非線形の回帰問題を解くこともできるらしい。Rのksvm(kernel support vector machine)関数を使えば，単調増加ではないが，比較的良さそうな回帰曲線を引くことができる。しかし，関数の返値から関数形を取り出し，予測値をうまく出力することができないため，関数の使用方法をもう少し勉強する必要があるだろう。  

##### Nonparametric IRT
　ノンパラメトリックIRTのICC推定方法についてすこし調べた。isotonic regressionは確かに単調増加の仮定を保持したままICCを描くことができるが，パラメトリックな関数を推定する方法でない（当然か）ため，今回の未観測カテゴリのパラメタ補完には用いることができないだろう。

#### 2019/04/18
##### GIRTモデルについての検討　その3
　$\phi$ の推定値はやはり安定して推定をすることが難しいが，GIRTの項目パラメタ推定をおこなうと，通常のIRTのMMLEよりも $a$ パラメタをやや真値に近い形でえることができる。この理由はまだ未検討。  
　$\phi$ はいわば，個人の能力のばらつきを示すパラメタであるため，同じようなパラメタの項目がたくさん（数百，数千）出題されたときに，どれくらい正答確率がばらつくのかという情報が，より多くなくては安定して推定することは難しい。これは事前分布の設定による問題ではなさそう。  
　$\phi$ の推定値改善だが，事前分布に真値の $\phi$ を利用したらどうなるか？もちろん実務ではそんなことはできないが，推定値の特性を知る上では，必要になるかもしれない。

##### GRMの未観測カテゴリパラメタ予測
　シグモイドカーネルを使えば，関数全体で単調増加が保証されるので，都合がよさそう。  
　項目のカテゴリ累積度数分布とカテゴリ困難度の対応をプロットしてみた。きれいなロジスティック（もしくは逆ロジスティック関数）の形になっている。これを利用すればカテゴリとカテゴリの間のパラメタを予測することができるかもしれない。しかも比較的容易に。  
　カテゴリ未観測の問題を一度整理。  
- 問題1：カテゴリ度数が少なすぎるためマージした場合。  
- 問題2：カテゴリ度数がそもそも観測されていない場合。  

　問題1の方はマージしたとはいえ，もとのカテゴリに属している受検者度数が分かるので，マージしたデータで項目パラメタを推定した後に，カテゴリ間のパラメタをマージ前の受検者度数の比を利用して推定すれば良いだろう。あるいは逆ロジスティック関数をフィッティングし，未観測のカテゴリ困難度を予測することができる。その場合，予測するのが項目パラメタで，独立変数は項目パラメタのカテゴリとなる（ $\theta$ とテスト総得点の関係を利用してもできるかもしれない）。  
　問題2はテスト項目から得ることができるカテゴリが $K_j - 1$ に固定されていることが問題である。項目パラメタとカテゴリを使ってロジスティック関数にフィッティングさせる方法であれば，こちらも同様に解決可能である。最大カテゴリが未観測の場合はロジスティック回帰に乗ずる係数を変更するだけで良い。
　

##### カテゴリ回帰予測手法の活用方法
　たとえばルーブリックと対応させて採点するような場合，カテゴリをマージして採点することは難しい。その場の採点では良いかもしれないが，追加で採点をおこなって，もしそのカテゴリが観測された場合に，アドホックに項目パラメタのラベルを変更して対応することになる。またTCCやTICの計算の際にメリットがある。TCCはカテゴリが未観測の場合，最大値が変化してしまう。確率ゼロのカテゴリを設けて対応することもできるが，そうするとTICの計算はなりゆかない。

#### 2019/04/19
##### GIRTの $\phi$ パラメタの推定精度改善について
　MAP推定のアルゴリズムは，ひとまずoptimise関数を利用する形で完成させた。本当であればニュートン法などもオプションで入れたいのだが。  
　MAP推定値を安定させる手法として，事前分布を適切なものにするとあるが，尤度が関数の形を観ると，個人によっては尤度関数の山が確認しにくいパターンも存在するようだ。また，反応パタンによってかなり山の最頻値が異なるし，尤度関数自体も真値の $\phi$ とは大きく外れた位置に山がある。そこで $\phi$ の事前分布の値を，person fit indexなどを参考に調節する方法を考えた。  
　ところでperson fit indexを計算するときは， $\phi$ をどのように扱えば良いだろうか。潜在変数が入っていると考える立場をとるのであれば， $\theta$ だけは固定して， $\phi$ は周辺化してしまうのが良いかもしれない。  

#### 2019/04/20
##### GIRTの $\phi$ パラメタの推定精度改善について
　 $z_3$統計量をベースに推定精度の改善を図ろうとしたが，思ったようにはいかなかった。 $\phi$ と $z_3$ の間には負の相関がありそうだ。

#### 2019/04/22
##### GRMシミュレーション
　GRMのシミュレーション期限は今月いっぱい（連休に入る前）。カテゴリ併合の感覚や，どれくらいまでカテゴリを縮約してしまって良いのかも検討できるとなお良い。  
　マージしたパラメタの間を等間隔に項目パラメタを補う関数を作成した。ところが，mirtのfscores関数はmirt専用のクラスオブジェクトしか受け付けないため，ちょっと躓いている。

#### 2019/04/23
##### GRMシミュレーション
　GRMのMAP推定アルゴリズムを急ごしらえで作成した（optimizeベース）。標準誤差とかは計算していないが，まあ良いだろう。そのうち改良していこう。今日の所は，とりあえず等間隔でマージしたカテゴリを補完する方法のMAP比較だけやった。相関係数はかなり良い感じなので，この方法でも大丈夫そう。あとは項目パラメタのRMSEも計算した方がいいか。  
　明日はless than 5の条件のコーディングから。
##### GIRTモデルの活用について
　MAP推定の事前分布に他適合度指標の情報を反映させる方法はうまくいかなかった。そもそも他適合度指標でも， $\phi$ とほぼ無相関な値が得られてしまっている。ここから察するに，個人の適合度を調べるために30項目程度では不十分な可能性が指摘できる。GIRTモデルによって個人の逸脱度合いが正しくモデリングされているのであればの話であるが。  
　GIRTモデルのシミュレーション（中馬, 2017）においては $\phi$ の事前分布の分散を大きくしすぎると級間分散に比べて級内分散が大きすぎてモデルに意味がなくなると書いてある。ひょっとしたら級内分散を小さく（$\phi$の事前分布の平均を小さく）すれば，推定がすこしは改善されるかもしれない。  
　そもそも実データで分析すると， $\phi$ の値はどんな感じになるのか？  
　乱数生成する $b$ パラの分布を変えてみてはどうか（一様乱数に，まんべんなく出題） = 100回のモンテカルロをやってみたところ，やや推定精度が向上した。相関係数でいうと，0.1くらい。

#### 2019/04/24
##### Torgerson (1958)
　結局，GIRTモデルの推定方法の参考になりそうなCase IIIの解法はこの本に載っていない。しかし，他のケースの推定方法は載っているので，何か参考になるかもしれないから調べてみよう

##### GRMシミュレーション
　観測度数に合わせてカテゴリパラメタを補完するには，一度マージしたカテゴリの受検者度数の合計で，未観測のカテゴリ間の距離を割り，その値を観測度数にかければよいだろう。

##### 2PL受検者削減シミュレーション
　項目および受検者のサンプルに使うハイパーパラメタをチューニングした。これで実際のFTにより近い形になった。  
　シミュレーションで分布の平均と標準偏差を0,1から動かした場合，aパラは標準偏差で割り，bパラは標準偏差をかけて平均を足せばよい。
