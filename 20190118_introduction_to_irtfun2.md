# Workstation of takuizum

01\_introduction\_to\_irtfun2
================
T.SHIBUYA
2019/1/18  
Turn to [home](index.html)

## `irtfun2` とは。

`irtfun2`は私が作成，維持している項目反応理論 (Item Response Theory, IRT)
の分析に特化したパッケージです。まだまだ機能は少ないですが，Rで使用可能なパッケージにはない，いくつかの機能を備えています。

  - 多母集団モデルでのパラメタ推定ができる。
  - 項目パラメタの推定方法として，周辺ベイズ推定法や正則化周辺最尤推定法が使用できる。
  - 一般項目反応モデル (Genelal IRT model) の分析ができる。

などです。特に多母集団モデルの分析は商用のBILOG-MGやフリーソフトの[Easy
Estimation](http://irtanalysis.main.jp/)などで実装されていますが，私の知る限り，Rでこれができるのは`lazy.irt`パッケージだけです（間違ってたら教えてください。なお，lazy.irtについては[こちら](http://mayekawa.in.coocan.jp/Rpackages.html)を参考にしてください)。  

推定アルゴリズムの中心部はC++で記述しているため，インストール時にコンパイルする必要がありますが，そのおかげで計算速度は他ソフトと比べても遜色ないものとなっています。

　とはいえ，まずはソフトを走らせてみることが，理解への早道だと思いますので，早速`irtfun2`をインストールして，関数を使用してみましょう。

## `estip`関数

``` r
library(irtfun2)
# ?estip
```

`Examples`のコードは仮想的に発生させた01のテストデータを`estip`で分析するものです。これを実行してみましょう。`estip`は２値型 (0 or 1) のデータの分析に対応しています。多値型は現在開発しようと思っていますが，モチベーションがあまり上がらないため，当分先になりそうです。部分採点モデル (Partial Credit Model, PCM) か名義反応モデル (Nominal Response Model, NRM) あたりを実装しようと考えています。  

詳しい説明は別の機会にしますが，引数のxはテストデータを，fcは項目反応データが何列目から始まるのかを与える場所です。途中の列に文字列が入っていたり，0と1以外の数値が入っているとエラーで止まります。  

Dは尺度定数です。D=1.702や1.7がよく用いられます。これはIRTモデルがもともと正規累積モデル (Nromar Ogive Model, NOM) として提案されていたため，その曲線に近似させるための定数です。正直なくても推定には影響しないのですが，識別力の値が変わってしまい，Dが異なるデータとは数値を直接比較できなくなります。もちろんD=１で推定したパラメタに1.702をかければ，D＝1.702で推定した結果と概ね一致するはずです。

``` r
system.time(
        res <- estip(x=sim_data_2, fc=2, D=1)
)
```

    Checking the model string vector 1 !
    The number of subject is 3000.
    The number of item is 30.
    The number of remove item is 0.
    Start calculating estimated item parameters.
    1 times -2 Marginal Log Likelihood is 95474.913018
    2 times -2 Marginal Log Likelihood is 85752.028118
    3 times -2 Marginal Log Likelihood is 85214.299600
    4 times -2 Marginal Log Likelihood is 84811.020518
    5 times -2 Marginal Log Likelihood is 84750.515248
    6 times -2 Marginal Log Likelihood is 84734.466952
    7 times -2 Marginal Log Likelihood is 84732.846787
    8 times -2 Marginal Log Likelihood is 84732.717677
    9 times -2 Marginal Log Likelihood is 84732.704531
    10 times -2 Marginal Log Likelihood is 84732.702835
    11 times -2 Marginal Log Likelihood is 84732.702593
    12 times -2 Marginal Log Likelihood is 84732.702557
    13 times -2 Marginal Log Likelihood is 84732.702551
    14 times -2 Marginal Log Likelihood is 84732.702551
    EM algorithm has been converged.
    Total iteration time is 14
    Start calculating estimated population distribution.
    1 times -2 Marginal Log Likelihood is 90759.040910
    2 times -2 Marginal Log Likelihood is 84813.300946
    3 times -2 Marginal Log Likelihood is 84731.271064
    4 times -2 Marginal Log Likelihood is 84723.558501
    5 times -2 Marginal Log Likelihood is 84721.421429
    6 times -2 Marginal Log Likelihood is 84720.456940
    7 times -2 Marginal Log Likelihood is 84719.905301
    8 times -2 Marginal Log Likelihood is 84719.546095
    9 times -2 Marginal Log Likelihood is 84719.293705

```
   user  system elapsed
   3.51    0.01    3.58
```

実行速度はおおよそ3.5秒といったところでしょうか。`estip`ではパラメタ推定後にもう一回EMサイクルを回して母集団分布を推定しているので，それを差し引けば多分2秒程度です。

　次に`irtoys`パッケージの`est`関数から`ltm`パッケージをたたいて，推定速度を比較してみましょう。今回使ったデータである`sim_dat_2`には一行目に受検者IDが入っていますので，それを取り除いて，`est`に渡してやります。ちなみにestは尺度定数を含んでいないので，D=1で計算されます。

``` r
library(irtoys)
system.time(
        res_irtoys <- irtoys::est(resp=irtfun2::sim_data_2[,-1], nqp = 31, engine = "ltm")
)
```

```
   user  system elapsed
  11.75    4.36   16.22
```

　16秒。こういっちゃなんですが，めっちゃ遅いですね。Hansonによるプログラム[ICL(IRT Command Language
)](http://www.openirt.com/b-a-h/software/irt/icl/icl_manual.pdf)をセットアップ済みであれば，engin=“icl”\`とすると高速になります。多分1秒かからないで計算できます。しかし，その場合推定の標準誤差を自分で計算する必要があるので面倒です。

　続いて，推定結果の比較です。 　 　

``` r
res$para
```

```
   Item         a            b c model
1  A001 1.4561439 -0.904402665 0   2PL
2  A002 1.3041904 -0.049954597 0   2PL
3  A003 1.4233161 -0.237319327 0   2PL
4  A004 1.9637083  0.962736508 0   2PL
5  A005 1.1052209 -0.864012281 0   2PL
6  A006 1.1960667  0.208423366 0   2PL
7  A007 1.2259104  2.427776560 0   2PL
8  A008 1.9901618  0.526670364 0   2PL
9  A009 2.1342850 -0.827380551 0   2PL
10 A010 1.3647894 -0.874546357 0   2PL
11 A011 1.6380770  2.682408990 0   2PL
12 A012 1.5100549 -0.794760792 0   2PL
13 A013 1.3881904  0.709867612 0   2PL
14 A014 2.0128825 -1.350521273 0   2PL
15 A015 2.6734427 -0.632137814 0   2PL
16 A016 2.4516389  0.518841067 0   2PL
17 A017 1.4334475  1.313319376 0   2PL
18 A018 1.6480882 -0.251074048 0   2PL
19 A019 2.3460301  0.170943689 0   2PL
20 A020 1.2351279  0.788546018 0   2PL
21 A021 2.7294077  1.786027251 0   2PL
22 A022 0.9898115  0.684174719 0   2PL
23 A023 1.4358349  0.335794823 0   2PL
24 A024 2.2451012 -0.009108298 0   2PL
25 A025 1.5335531 -0.143532655 0   2PL
26 A026 1.4261371  0.003391422 0   2PL
27 A027 2.0224886 -0.861116662 0   2PL
28 A028 1.7258029 -1.553747712 0   2PL
29 A029 1.1916958 -0.239445170 0   2PL
30 A030 1.1123641  1.023682766 0   2PL
```

``` r
res_irtoys$est
```

```
          [,1]          [,2] [,3]
A001 1.4543992 -0.9083046905    0
A002 1.3019194 -0.0528026341    0
A003 1.4200612 -0.2405108005    0
A004 1.9619485  0.9614718359    0
A005 1.1031374 -0.8691319111    0
A006 1.1947129  0.2057251079    0
A007 1.2245297  2.4278451509    0
A008 1.9836192  0.5251770463    0
A009 2.1308715 -0.8316410694    0
A010 1.3631839 -0.8785322688    0
A011 1.6340988  2.6853918054    0
A012 1.5086780 -0.7983877910    0
A013 1.3847439  0.7087233208    0
A014 2.0105509 -1.3552906367    0
A015 2.6684723 -0.6366019885    0
A016 2.4493313  0.5165426334    0
A017 1.4315229  1.3129328552    0
A018 1.6455172 -0.2542600093    0
A019 2.3405886  0.1679609143    0
A020 1.2325528  0.7870565584    0
A021 2.7218865  1.7862647950    0
A022 0.9891123  0.6807682918    0
A023 1.4320332  0.3339029023    0
A024 2.2410959 -0.0124746367    0
A025 1.5318695 -0.1464398713    0
A026 1.4226820  0.0007174707    0
A027 2.0230459 -0.8646786255    0
A028 1.7221911 -1.5592917435    0
A029 1.1903089 -0.2427971931    0
A030 1.1103365  1.0222292055    0
```

　おおよそ，小数点第2位から第3位あたりまで一致しています。推定の標準誤差はどうでしょうか。 　

``` r
res$SE
```

```
   Item          a          b c model
1  A001 0.06279092 0.03890351 0   2PL
2  A002 0.05475825 0.03234224 0   2PL
3  A003 0.05788068 0.03086253 0   2PL
4  A004 0.08221842 0.03188003 0   2PL
5  A005 0.05271214 0.04795262 0   2PL
6  A006 0.05248516 0.03518946 0   2PL
7  A007 0.08254678 0.12268044 0   2PL
8  A008 0.07676201 0.02571978 0   2PL
9  A009 0.08477710 0.02786245 0   2PL
10 A010 0.05980236 0.04037995 0   2PL
11 A011 0.12775422 0.13257904 0   2PL
12 A012 0.06332816 0.03574018 0   2PL
13 A013 0.05974535 0.03667116 0   2PL
14 A014 0.09232066 0.03967777 0   2PL
15 A015 0.10194399 0.02192509 0   2PL
16 A016 0.09310079 0.02210799 0   2PL
17 A017 0.06819875 0.05053287 0   2PL
18 A018 0.06388586 0.02767879 0   2PL
19 A019 0.08570677 0.02120610 0   2PL
20 A020 0.05607001 0.04196783 0   2PL
21 A021 0.15771212 0.04603543 0   2PL
22 A022 0.04934467 0.04827105 0   2PL
23 A023 0.05880608 0.03117682 0   2PL
24 A024 0.08169544 0.02171629 0   2PL
25 A025 0.06058490 0.02874561 0   2PL
26 A026 0.05777503 0.03011600 0   2PL
27 A027 0.08123027 0.02947193 0   2PL
28 A028 0.08467719 0.05128893 0   2PL
29 A029 0.05229205 0.03556701 0   2PL
30 A030 0.05446897 0.05205912 0   2PL
```

``` r
res_irtoys$se
```

```
            [,1]       [,2] [,3]
 [1,] 0.07053757 0.04537262    0
 [2,] 0.06114222 0.03728654    0
 [3,] 0.06497903 0.03618226    0
 [4,] 0.09582541 0.03999081    0
 [5,] 0.05795847 0.05357359    0
 [6,] 0.05826361 0.03992110    0
 [7,] 0.09042089 0.13568639    0
 [8,] 0.08911879 0.03280952    0
 [9,] 0.09936626 0.03567732    0
[10,] 0.06685806 0.04656523    0
[11,] 0.14318591 0.15071663    0
[12,] 0.07150574 0.04212442    0
[13,] 0.06690365 0.04280334    0
[14,] 0.10731198 0.04895874    0
[15,] 0.12342784 0.03015063    0
[16,] 0.11257808 0.03001640    0
[17,] 0.07655945 0.05854440    0
[18,] 0.07269184 0.03352697    0
[19,] 0.10178636 0.02847665    0
[20,] 0.06216161 0.04783662    0
[21,] 0.19321044 0.06002212    0
[22,] 0.05401095 0.05318612    0
[23,] 0.06613147 0.03670675    0
[24,] 0.09658386 0.02869965    0
[25,] 0.06869178 0.03427133    0
[26,] 0.06493559 0.03539387    0
[27,] 0.09491540 0.03710286    0
[28,] 0.09636229 0.06080285    0
[29,] 0.05799829 0.04026380    0
[30,] 0.05994564 0.05827339    0
```

　推定値自体が小数点第3位あたりでずれているので，まあ概ね一致していると言えるでしょう。

Turn to [home](takuizum.github.io)
